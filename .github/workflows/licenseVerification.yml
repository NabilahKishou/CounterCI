name: Verify Unity License

on:
  workflow_dispatch:  # run manually

jobs:
  verify-unity-license:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Detect Unity Version
        id: unity_version
        run: |
          FILE="ProjectSettings/ProjectVersion.txt"
          if [ ! -f "$FILE" ]; then
            echo "❌ ProjectVersion.txt not found"
            exit 1
          fi
          VERSION=$(grep '^m_EditorVersion:' "$FILE" | sed -E 's/^m_EditorVersion:\s*//')
          echo "Unity version detected: $VERSION"
          echo "unity_version=$VERSION" >> $GITHUB_OUTPUT

      - name: Verify Unity License
        uses: game-ci/unity-activate@v2
        with:
          unityVersion: ${{ steps.unity_version.outputs.unity_version }}
          email: ${{ secrets.UNITY_EMAIL }}
          password: ${{ secrets.UNITY_PASSWORD }}
          license: ${{ secrets.UNITY_LICENSE }}
